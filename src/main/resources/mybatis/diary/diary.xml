<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.demo.diary.dao.DiaryDao">

  <!-- 일기 생성 -->
 <insert id="insertDiary" parameterType="Diary">
    INSERT INTO DIARYS 
  (MID, TITLE, CONTENT, VIEW_SCOPE, EMO, WEATHER)
VALUES 
  (#{mid}, #{title}, #{content}, #{viewScope}, #{emo}, #{weather})

  </insert>

  <!--일기 생성 후 DID값이 보이지 않아 DID를 select문으로 수동으로 보여주기 (마지막 삽입된 행 조회 (해당 사용자의 가장 최근 작성 글)-->
<select id="selectLatestDiary" parameterType="long" resultType="Diary">
  SELECT DID as did, MID as mid, TITLE as title, CONTENT as content, VIEW_SCOPE as viewScope, EMO as emo, WEATHER as weather, CREATED_AT as createdAt, UPDATED_AT as updatedAt
  FROM DIARYS
  WHERE MID = #{mid}
  ORDER BY CREATED_AT DESC
  FETCH FIRST 1 ROWS ONLY
</select>

<!-- 단건 조회 -->
<select id="selectDiaryById" parameterType="long" resultType="Diary">
    SELECT DID as did, MID as mid,TITLE as title, CONTENT as content, VIEW_SCOPE as viewScope, EMO as emo, WEATHER as weather, CREATED_AT as createdAt, UPDATED_AT as updatedAt
    FROM DIARYS
    WHERE DID = #{did}
</select>

<!-- 전체 목록 조회 -->
 <select id="selectAllDiaries" resultType="Diary">
    SELECT DID as did, MID as mid, TITLE as title, CONTENT as content, EMO as emo, WEATHER as weather, VIEW_SCOPE as viewScope, CREATED_AT as createdAt, UPDATED_AT as updatedAt
    FROM DIARYS
    ORDER BY CREATED_AT DESC
 </select>

 <!--페이징을 위한 전체 행 수 가져오기-->
 <select id="countDiaries" resultType="long">
  SELECT COUNT(*)
  FROM DIARYS
 </select>

 <!-- 페이징 목록 조회 -->
<select id="selectDiariesByPage" resultType="Diary" parameterType="map">
  <![CDATA[ 
  SELECT *
  FROM (
      SELECT ROWNUM rnum, d.*
      FROM (
            SELECT DID as did, MID as mid, TITLE as title, CONTENT as content, EMO as emo, WEATHER as weather, VIEW_SCOPE as viewScope, CREATED_AT as createdAt, UPDATED_AT as updatedAt
            FROM DIARYS
            ORDER BY CREATED_AT DESC
      ) d
       WHERE ROWNUM <= #{endRowNo}
  )
  WHERE rnum >= #{startRowNo}
  ]]>
</select>


 <!-- 수정 -->
  <update id="updateDiary" parameterType="Diary">
    UPDATE DIARYS
    SET TITLE = #{title}, CONTENT = #{content}, EMO = #{emo}, WEATHER = #{weather}, VIEW_SCOPE = #{viewScope}, UPDATED_AT = SYSTIMESTAMP
    WHERE DID = #{did}
  </update>

  <!-- 삭제 -->
   <delete id="deleteDiary" parameterType="int">
    DELETE FROM DIARYS
    WHERE DID = #{did}
   </delete>

</mapper>