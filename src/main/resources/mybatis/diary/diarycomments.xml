<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.demo.diary.dao.DiarysCommentDao">
  <insert id="insert" parameterType="DiaryComments" useGeneratedKeys="true" keyProperty="dcid" keyColumn="DCID">
    INSERT INTO DIARY_COMMENTS (DID, MID, CONTENT, CREATED_AT, UPDATED_AT)
    VALUES (#{did}, #{mid}, #{content}, SYSTIMESTAMP, SYSTIMESTAMP)
  </insert>
  <!--insert용 조회-->
  <select id="selectByDcid" parameterType="Long" resultType="DiaryComments">
    SELECT *
    FROM DIARY_COMMENTS
    WHERE DCID = #{dcid}
  </select>
  <!--상세조회 Read용-->
  <select id="selectByDidAndDcid" parameterType="Long" resultType="DiaryComments">
    SELECT *
    FROM DIARY_COMMENT
    WHERE DID = #{did} AND DCID = #{dcid}
  </select>
  <!-- 댓글 수정 (did와 comment DTO 기준) -->
  <update id="update" parameterType="map">
    UPDATE DIARY_COMMENTS <!-- 모든 쿼리의 테이블 이름을 DIARY_COMMENT로 통일 -->
    SET
      CONTENT = #{comment.content},
      UPDATED_AT = SYSTIMESTAMP  <!-- DB에서 현재 시각을 직접 기록 -->
    WHERE DCID = #{comment.dcid} AND DID = #{did} <!-- did를 사용하여 보안 검증 -->
  </update>
  <!--댓글 삭제-->
  <delete id="delete" parameterType="map">
    DELETE FROM DIARY_COMMENTS
    WHERE DCID = #{dcid}
  </delete>
</mapper>