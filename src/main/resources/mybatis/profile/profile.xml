<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.demo.profile.dao.ProfileDao">
  <insert id="insert" parameterType="Profile">
    INSERT INTO PROFILES (MID, NICKNAME, BIRTHDATE)
    VALUES (#{mid}, #{nickname}, #{birthdate})
  </insert>
  
  <select id="countByNickname" parameterType="String" resultType="int">
    SELECT COUNT(*)
    FROM profiles
    WHERE nickname = #{nickname}
  </select>
  <!-- <select id="selectByPid" resultType="Profile">
    SELECT * FROM PROFILES WHERE PID = #{pid}
  </select>
   
  <select id="selectByMid" resultType="Profile">
    SELECT * FROM PROFILES WHERE MID = #{mid}
  </select>  -->


  <select id="selectByPid" resultType="com.example.demo.profile.dto.Profile">
    SELECT
        PID,
        MID,
        NICKNAME,
        TO_CHAR(BIRTHDATE, 'YYYY-MM-DD') AS BIRTHDATE, -- DATE를 강제로 문자열로 변환
        STATUS_MESSAGE,
        INTRO,
        MAIN_ADDRESS,
        JID
    FROM
        PROFILES
    WHERE
        PID = #{pid}
</select>

<select id="selectByMid" resultType="com.example.demo.profile.dto.Profile">
    SELECT
        PID,
        MID,
        JID,
        NICKNAME,
        TO_CHAR(BIRTHDATE, 'YYYY-MM-DD') AS BIRTHDATE, -- DATE를 강제로 문자열로 변환
        IMG_NAME,
        IMG_URL,
        STATUS_MESSAGE,
        INTRO,
        MAIN_ADDRESS
    FROM
        PROFILES
    WHERE
        MID = #{mid}
</select>
  <update id="update">
      UPDATE PROFILES
      <set>
          <if test="dto.jid != null">
              JID = #{dto.jid},
          </if>
          <if test="dto.nickname != null and dto.nickname != ''">
              NICKNAME = #{dto.nickname},
          </if>
          <if test="dto.birthdate != null">
              BIRTHDATE = #{dto.birthdate},
          </if>
          <if test="dto.statusMessage != null">
              STATUS_MESSAGE = #{dto.statusMessage},
          </if>
          <if test="dto.intro != null">
              INTRO = #{dto.intro},
          </if>
          <if test="dto.mainAddress != null">
              MAIN_ADDRESS = #{dto.mainAddress},
          </if>
      </set>
      WHERE MID = #{mid}
  </update>

  <update id="updateImage">
      UPDATE PROFILES
      SET
          IMG_NAME = #{imgName},
          IMG_URL = #{imgUrl}
      WHERE
          MID = #{mid}
  </update>
    
</mapper>